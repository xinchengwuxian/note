### 产品实例

- 云主机
- VPC（UXR）
- 各种异构网关
- ULB
- CNAT
- UGN
- RGW(SDNGW)

### 云网络要解决的问题

##### 内外网互联（ipv4, ipv6）

- 方案：

  1. 外网流量接入

     对应产品或服务：UVER(外网网关)， UVER2（IPv6外网网关）

  1. 配置弹性IP,能够访问外网，也能对外提供服务

     对应产品：EIP

  2. NAT网关，能够访问外网，也可通过端口映射实现多主机对外提供服务

     对应产品：NATGW

##### 支持负载均衡

- 方案：
  1. ULB4 传输层负载均衡（ECMP, DR模式）
  2. ULB7 应用层负载均衡 （full nat模式）

##### 公有云私有网络的实现

- 方案：

  1. 通过VPC实现，支持子网划分，路由表配置，ACL策略配置

- VPC 架构演进

  1. VPC1.0(内核Bridge,大二层)

     - 实现：

     - 问题：性能差，广播域大，不好做隔离，高级特性不好满足

  2. VPC2.0(SDN架构，ovs + sdn controller)

     问题：首包时延大，控制器易受DDos攻击，脏流表

  3. VPC3.0（主动推送 + 动态学习 微服务化网关）

     新架构优势：支持大规模VPC，变更实时生效，统一控制面

##### 公有云私有网络的广播功能

- 方案：通过BGW 实现VPC内部的广播报文的转发功能
- 对应产品和服务：BGW

##### 公有云私有网络的同区互通

- 方案：通过控制器下发对应流表实现，不需要其他模块配合

##### 公有云私有网络的跨域互通

- 方案：需要UDPN高速通道配合，互联SDNGW，私有网络通过添加到SDNGW的路由表，将跨域流量转发到SDNGW，SDNGW实现域间通信

- 对应产品和服务：SDNGW，UDPN

##### 托管云与公有云网络的互通

- 方案：混合云
- 对应产品和服务：混合云

##### 异构网络网关实现

- 混合云网关 - HCGW（网关需要保证数据安全性，高可用，网络稳定，租户隔离）

  1. 架构演进

     - CloudGW架构（用户IDC和公有云通过CloudGw互联）
       - 实现方式：linux内核网络协议栈设计
       - 高可用：通过keepalived实现主备
       - 租户隔离实现方式：物理主机隔离和namespace隔离
       - 缺点：
         - 主备实现不能发挥备用机价值，资源有浪费 ---> 通过实现集群保证
         - 不能达到网卡的限速转发（通过下一代架构解决）

     - Vpc网关架构（基于DPDK的软件实现方案）
       - 能够自定义划分网段
       - 基于DPDK的混合云集群架构（为了满足更高的网关转发性能）

     - Uxr网关架构（基于P4的硬件可编程交换机的网关）
       - 有更高的转发性能
       - 支持跨可用区的容灾

- 物理云网关 - VPCGW

  - 主要实现物理云与公有云的互通
  - 利用LACP动态链路聚合实现高可用

- 跨域网关 - SDNGW

- VPN网关 - VPNGW

##### 各种异构网络的路由管理和隔离

- 方案：通过UXR实现一个中心化网关，在各种异构网络网关中学习路由信息，同时实现路由信息的隔离
- 对应产品和服务：UXR

- 解决方案需要高可用，保证性能，灰度，租户隔离

##### 方便各地域VPC互通

- 方案：实现UGN(云联网)，改造升级SDNGW为RGW，更便捷支持用户云接入

  - sdngw互通方案未发现文档

  - Ugn架构图  

- 产品和服务：UGN，RGW

### 场景理解

- 场景一：配置NAT网关，创建VPC子网，配置ACL规则，配置路由表
- 场景一： 相同区VPC互通

- 场景二：不同域VPC互通

  通过UDPN实现：高速通道是通过将需要互通的VPC的流量通过路由表转发到SDNGW，两边的SDNGW通过UDPN的管理面获取到下发的流表，通过匹配流表做对应的流量转发（流表设计）

- 场景三：公有云和托管云互通（动态路由）

  之前：公有云和托管云配置静态路由，现在能够动态学习路由

  frrservice:主要监听PE上的BGP路由信息

  brm:获取frrservice的路由变更信息，更新到数据库

  hrm:从数据库拉取路由信息，上报到UXR

  问题：通过异构网络网关安装BGP，实现BGP的路由通告（跨域子网不能通告）

- 场景五：托管云网关实现

  第一代：clouldGW基于linux内核转发，不能发挥网卡的限速转发性能（基础网络）

  第二代：VPC网关架构（基于DPDK实现的集群架构）

  第三代：URX混合云网关（基于硬件的可编程交换机）

  演变历程：kernel转发 ---> 基于DPDK的软件实现方案 --> 基于P4的硬件实现方案







